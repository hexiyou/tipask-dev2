(function(e){if(e.xheditor)return false;e.fn.xheditor=function(C){var D=[];this.each(function(){if(e.nodeName(this,"TEXTAREA"))if(C===false){if(this.xheditor){this.xheditor.remove();this.xheditor=null}}else if(this.xheditor)D.push(this.xheditor);else{var H=/({.*})/.exec(e(this).attr("class"));if(H){try{H=eval("("+H[1]+")")}catch(Va){}C=e.extend({},H,C)}H=new e.xheditor(this,C);if(H.init()){this.xheditor=H;D.push(H)}}});if(D.length===0)D=false;if(D.length===1)D=D[0];return D};var ea=0,Ea=e.browser.version,
B=e.browser.msie,va=e.browser.mozilla,U=e.browser.safari,lb=e.browser.opera,Q=false,wa=true,xa=false,Wa=false,L,ka,la,fa,Y,Fa,ga,Ga,Ha,Ia,V;e("script[src*=xheditor]").each(function(){var C=this.src;if(C.match(/xheditor[^\/]*\.js/i)){V=C.replace(/[\?#].*$/,"").replace(/(^|[\/\\])[^\/]*$/,"$1");return false}});var mb={27:"esc",9:"tab",32:"space",13:"enter",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",
39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"},nb=["#FFFFFF","#CCCCCC","#C0C0C0","#999999","#666666","#333333","#000000","#FFCCCC","#FF6666","#FF0000","#CC0000","#990000","#660000","#330000","#FFCC99","#FF9966","#FF9900","#FF6600","#CC6600","#993300","#663300","#FFFF99","#FFFF66","#FFCC66","#FFCC33","#CC9933","#996633","#663333","#FFFFCC","#FFFF33","#FFFF00","#FFCC00","#999900","#666600","#333300","#99FF99","#66FF99",
"#33FF33","#33CC00","#009900","#006600","#003300","#99FFFF","#33FFFF","#66CCCC","#00CCCC","#339999","#336666","#003333","#CCFFFF","#66FFFF","#33CCFF","#3366FF","#3333FF","#000099","#000066","#CCCCFF","#9999FF","#6666CC","#6633FF","#6600CC","#333399","#330099","#FFCCFF","#FF99FF","#CC66CC","#CC33CC","#993399","#663366","#330033"],ob=[{n:"p",t:"\u666e\u901a\u6bb5\u843d"},{n:"h1",t:"\u6807\u98981"},{n:"h2",t:"\u6807\u98982"},{n:"h3",t:"\u6807\u98983"},{n:"h4",t:"\u6807\u98984"},{n:"h5",t:"\u6807\u98985"},
{n:"h6",t:"\u6807\u98986"},{n:"pre",t:"\u5df2\u7f16\u6392\u683c\u5f0f"},{n:"address",t:"\u5730\u5740"}],pb=[{n:"\u5b8b\u4f53",c:"SimSun"},{n:"\u4eff\u5b8b\u4f53",c:"FangSong_GB2312"},{n:"\u9ed1\u4f53",c:"SimHei"},{n:"\u6977\u4f53",c:"KaiTi_GB2312"},{n:"\u5fae\u8f6f\u96c5\u9ed1",c:"Microsoft YaHei"},{n:"Arial"},{n:"Arial Narrow"},{n:"Arial Black"},{n:"Comic Sans MS"},{n:"Courier New"},{n:"System"},{n:"Times New Roman"},{n:"Tahoma"},{n:"Verdana"}],R=[{n:"xx-small",wkn:"x-small",s:"8pt",t:"\u6781\u5c0f"},
{n:"x-small",wkn:"small",s:"10pt",t:"\u7279\u5c0f"},{n:"small",wkn:"medium",s:"12pt",t:"\u5c0f"},{n:"medium",wkn:"large",s:"14pt",t:"\u4e2d"},{n:"large",wkn:"x-large",s:"18pt",t:"\u5927"},{n:"x-large",wkn:"xx-large",s:"24pt",t:"\u7279\u5927"},{n:"xx-large",wkn:"-webkit-xxx-large",s:"36pt",t:"\u6781\u5927"}],qb=[{s:"\u5de6\u5bf9\u9f50",v:"justifyleft"},{s:"\u5c45\u4e2d",v:"justifycenter"},{s:"\u53f3\u5bf9\u9f50",v:"justifyright"},{s:"\u4e24\u7aef\u5bf9\u9f50",v:"justifyfull"}],rb=[{s:"\u6570\u5b57\u5217\u8868",
v:"insertOrderedList"},{s:"\u7b26\u53f7\u5217\u8868",v:"insertUnorderedList"}],sb={"default":{name:"\u9ed8\u8ba4",width:24,height:24,line:7,list:{smile:"\u5fae\u7b11",tongue:"\u5410\u820c\u5934",titter:"\u5077\u7b11",laugh:"\u5927\u7b11",sad:"\u96be\u8fc7",wronged:"\u59d4\u5c48",fastcry:"\u5feb\u54ed\u4e86",cry:"\u54ed",wail:"\u5927\u54ed",mad:"\u751f\u6c14",knock:"\u6572\u6253",curse:"\u9a82\u4eba",crazy:"\u6293\u72c2",angry:"\u53d1\u706b",ohmy:"\u60ca\u8bb6",awkward:"\u5c34\u5c2c",panic:"\u60ca\u6050",
shy:"\u5bb3\u7f9e",cute:"\u53ef\u601c",envy:"\u7fa1\u6155",proud:"\u5f97\u610f",struggle:"\u594b\u6597",quiet:"\u5b89\u9759",shutup:"\u95ed\u5634",doubt:"\u7591\u95ee",despise:"\u9119\u89c6",sleep:"\u7761\u89c9",bye:"\u518d\u89c1"}}},ma={Cut:{t:"\u526a\u5207 (Ctrl+X)"},Copy:{t:"\u590d\u5236 (Ctrl+C)"},Paste:{t:"\u7c98\u8d34 (Ctrl+V)"},Pastetext:{t:"\u7c98\u8d34\u6587\u672c",h:B?0:1},Blocktag:{t:"\u6bb5\u843d\u6807\u7b7e",h:1},Fontface:{t:"\u5b57\u4f53",h:1},FontSize:{t:"\u5b57\u4f53\u5927\u5c0f",
h:1},Bold:{t:"\u52a0\u7c97 (Ctrl+B)",s:"Ctrl+B"},Italic:{t:"\u659c\u4f53 (Ctrl+I)",s:"Ctrl+I"},Underline:{t:"\u4e0b\u5212\u7ebf (Ctrl+U)",s:"Ctrl+U"},Strikethrough:{t:"\u5220\u9664\u7ebf (Ctrl+S)",s:"Ctrl+S"},FontColor:{t:"\u5b57\u4f53\u989c\u8272",h:1},BackColor:{t:"\u80cc\u666f\u989c\u8272",h:1},SelectAll:{t:"\u5168\u9009 (Ctrl+A)"},Removeformat:{t:"\u5220\u9664\u6587\u5b57\u683c\u5f0f"},Align:{t:"\u5bf9\u9f50",h:1},List:{t:"\u5217\u8868",h:1},Outdent:{t:"\u51cf\u5c11\u7f29\u8fdb (Shift+Tab)",s:"Shift+Tab"},
Indent:{t:"\u589e\u52a0\u7f29\u8fdb (Tab)",s:"Tab"},Link:{t:"\u8d85\u94fe\u63a5 (Ctrl+K)",s:"Ctrl+K",h:1},Unlink:{t:"\u53d6\u6d88\u8d85\u94fe\u63a5"},Img:{t:"\u56fe\u7247",h:1},Flash:{t:"Flash\u52a8\u753b",h:1},Media:{t:"\u591a\u5a92\u4f53\u6587\u4ef6",h:1},Emot:{t:"\u8868\u60c5",s:"ctrl+e",h:1},Table:{t:"\u8868\u683c",h:1},Source:{t:"\u6e90\u4ee3\u7801"},Preview:{t:"\u9884\u89c8"},Print:{t:"\u6253\u5370 (Ctrl+P)",s:"Ctrl+P"},Fullscreen:{t:"\u5168\u5c4f\u7f16\u8f91 (Esc)",s:"Esc"},About:{t:"\u5173\u4e8e xhEditor"}},
Ja={mini:"Bold,Italic,Underline,Strikethrough,|,Align,List,|,Link,Img",simple:"Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,|,Align,List,Outdent,Indent,|,Link,Img,Emot",full:"Cut,Copy,Paste,Pastetext,|,Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,SelectAll,Removeformat,|,Align,List,Outdent,Indent,|,Link,Unlink,Img,Flash,Media,Emot,Table,|,Source,Preview,Print,Fullscreen"};Ja.mfull=Ja.full.replace(/\|(,Align)/i,"/$1");var tb=
{a:"Link",img:"Img",embed:"Embed"};e.xheditor=function(C,D){function H(a){a=a.target;var b=tb[a.tagName.toLowerCase()];if(b){if(b==="Embed")b={"application/x-shockwave-flash":"Flash","application/x-mplayer2":"Media"}[a.type.toLowerCase()];d.exec(b)}}function Va(a){if(a.which===27){if(xa)d.removeModal();else Q&&d.hidePanel();return false}}function Xa(){setTimeout(d.setSource,10)}function na(){d.getSource()}function ub(a){if(G||Ka)return true;Ka=true;d.saveBookmark();var b=e('<div style="position:absolute;left:-1000px;top:'+
Z.scrollTop()+'px;overflow:hidden;width:1px;height:1px;" />',v),c=b[0],g=d.getSel(),n=d.getRng(true);e(v.body).append(b);if(B){n.moveToElementText(c);n.execCommand("Paste");a.preventDefault()}else{n.selectNodeContents(c);g.removeAllRanges();g.addRange(n)}setTimeout(function(){var k=p.forcePasteText,l;l=k?b.text():c.innerHTML;b.remove();d.loadBookmark();if(k)d.pasteText(l);else{l=d.cleanHTML(l);l=d.formatXHTML(l);l=d.cleanWord(l);d.pasteHTML(l)}Ka=false},0)}function La(a){try{d._exec("styleWithCSS",
a,true)}catch(b){try{d._exec("useCSS",!a,true)}catch(c){}}}function Ma(){if(Na&&!G){La(false);try{d._exec("enableObjectResizing",true,true)}catch(a){}if(B)try{d._exec("BackgroundImageCache",true,true)}catch(b){}}}function vb(a){if(G||a.which!==13||a.shiftKey||a.ctrlKey||a.altKey)return true;a=d.getParent("p,h1,h2,h3,h4,h5,h6,pre,address,div,li");if(a.is("li"))return true;if(p.forcePtag)a.length===0&&d._exec("formatblock","<p>");else{d.pasteHTML("<br />");B&&a.length>0&&d.getRng().parentElement().childNodes.length===
2&&d.pasteHTML("<br />");return false}}function Oa(){if(!va&&!U){oa&&N.height("100%").css("height",N.outerHeight()-K.outerHeight());B&&K.hide().show()}}function wb(a){a=a.target;if(a.tagName.match(/(img|embed)/i)){var b=d.getSel(),c=d.getRng(true);c.selectNode(a);b.removeAllRanges();b.addRange(c)}}function $(a,b,c){if(!b)return false;var g="_xhe_"+b;if(c){if(ya)c=aa(c,ya,O);a.attr(b,O?aa(c,"abs",O):c).removeAttr(g).attr(g,c)}return a.attr(g)||a.attr(b)}function Pa(){wa&&d.hidePanel()}function xb(a){if(G)return true;
var b=a.which,c=mb[b];b=c?c:String.fromCharCode(b).toLowerCase();sKey="";sKey+=a.ctrlKey?"ctrl+":"";sKey+=a.altKey?"alt+":"";sKey+=a.shiftKey?"shift+":"";sKey+=b;a=pa[sKey];var g;for(g in a){g=a[g];if(e.isFunction(g)){if(g.call(d)===false)return false}else{d.exec(g);return false}}}function ba(a,b){var c=typeof a;if(!b)return c!="undefined";if(b==="array"&&a.hasOwnProperty&&a instanceof Array)return true;return c===b}function aa(a,b,c){if(a.match(/^(file|mailto|ftp):\/\//i))return a;var g=c?e('<a href="'+
c+'" />')[0]:location;c=g.protocol;var n=g.host,k=g.hostname,l=g.port;g=g.pathname.replace(/\\/g,"/").replace(/[^\/]+$/i,"");if(l==="")l="80";if(g==="")g="/";else if(g.charAt(0)!=="/")g="/"+g;a=e.trim(a);if(b!=="abs")a=a.replace(RegExp(c+"\\/\\/"+k.replace(/\./g,"\\.")+"(?::"+l+")"+(l==="80"?"?":"")+"(/|$)","i"),"/");if(b==="rel")a=a.replace(RegExp("^"+g.replace(/([\/\.\+\[\]\(\)])/g,"\\$1"),"i"),"");if(b!=="rel"){a.match(/^(https?:\/\/|\/)/i)||(a=g+a);if(a.charAt(0)==="/"){k=[];a=a.split("/");var i=
a.length;for(g=0;g<i;g++){l=a[g];if(l==="..")k.pop();else l!==""&&l!=="."&&k.push(l)}a[i-1]===""&&k.push("");a="/"+k.join("/")}}if(b==="abs"&&!a.match(/^https?:\/\//i))a=c+"//"+n+a;return a=a.replace(/(https?:\/\/[^:\/?#]+):80(\/|$)/i,"$1$2")}function Ya(a,b){if(b==="*"||a.match(RegExp(".("+b.replace(/,/g,"|")+")$","i")))return true;else{alert("\u4e0a\u4f20\u6587\u4ef6\u6269\u5c55\u540d\u5fc5\u9700\u4e3a: "+b);return false}}function Za(a){var b=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,
Math.floor(b))).toFixed(2)+["Byte","KB","MB","GB","TB","PB"][b]}function W(){return false}var d=this,S=e(C),$a=S.closest("form"),K,N,X,Z,v,za,ha,Na=false,G=false,oa=false,Ka=false,ab,qa=false,bb="",P=null,Qa,ra=false,Ra=false,ia=null,ca=null,T=0,p=d.settings=e.extend({},{skin:"default",tools:"full",clickCancelDialog:true,linkTag:false,internalScript:false,inlineScript:false,internalStyle:true,inlineStyle:true,showBlocktag:false,forcePtag:true,upLinkExt:"zip,rar,txt",upImgExt:"jpg,jpeg,gif,png",upFlashExt:"swf",
upMediaExt:"wmv,avi,wma,mp3,mid",modalWidth:350,modalHeight:220,modalTitle:true,defLinkText:"\u70b9\u51fb\u6253\u5f00\u94fe\u63a5",layerShadow:3,emotMark:false,upBtnText:"\u4e0a\u4f20",wordDeepClean:true,hoverExecDelay:100,html5Upload:true,upMultiple:99},D),Aa=p.plugins,Ba=[];if(Aa){ma=e.extend({},ma,Aa);e.each(Aa,function(a){Ba.push(a)});Ba=Ba.join(",")}if(p.tools.match(/^\s*(m?full|simple|mini)\s*$/i)){var cb=Ja[e.trim(p.tools)];p.tools=p.tools.match(/m?full/i)&&Aa?cb.replace("Table","Table,"+Ba):
cb}p.tools.match(/(^|,)\s*About\s*(,|$)/i);p.tools=p.tools.split(",");if(p.editorRoot)V=p.editorRoot;V=aa(V,"abs");if(p.urlBase)p.urlBase=aa(p.urlBase,"abs");var db="xheCSS_"+p.skin,sa="xhe"+ea+"_container",eb="xhe"+ea+"_Tool",fb="xhe"+ea+"_iframearea",gb="xhe"+ea+"_iframe",Ca="xhe"+ea+"_fixffcursor",ta="",ja="",Sa=V+"xheditor_skin/"+p.skin+"/",Da=sb,ya=p.urlType,O=p.urlBase,da=p.emotPath;da=da?da:V+"xheditor_emot/";var Ta="";Da=e.extend({},Da,p.emots);da=aa(da,"rel",O?O:null);
if(qa=p.showBlocktag)ja+=" showBlocktag";var pa=[];this.init=function(){e("#"+db).length===0&&e("head").append('<link id="'+db+'" rel="stylesheet" type="text/css" href="'+Sa+'ui.css" />');var a=p.width||C.style.width||S.outerWidth();T=p.height||C.style.height||S.outerHeight();if(ba(T,"string"))T=T.replace(/[^\d]+/g,"");if(a<=0||T<=0){alert("\u5f53\u524dtextarea\u5904\u4e8e\u9690\u85cf\u72b6\u6001\uff0c\u8bf7\u5c06\u4e4b\u663e\u793a\u540e\u518d\u521d\u59cb\u5316xhEditor\uff0c\u6216\u8005\u76f4\u63a5\u8bbe\u7f6etextarea\u7684width\u548cheight\u6837\u5f0f");
return false}if(/^[0-9\.]+$/i.test(""+a))a+="px";var b=p.background||C.style.background,c=['<span class="xheGStart"/>'],g,n,k=/\||\//i;e.each(p.tools,function(f,h){h.match(k)&&c.push('<span class="xheGEnd"/>');if(h==="|")c.push('<span class="xheSeparator"/>');else if(h==="/")c.push("<br />");else{g=ma[h];if(!g)return;n=g.c?g.c:"xheIcon xheBtn"+h;c.push('<span><a href="javascript:void(0);" title="'+g.t+'" name="'+h+'" class="xheButton xheEnabled" tabindex="-1"><span class="'+n+'" unselectable="on" /></a></span>');
g.s&&d.addShortcuts(g.s,h)}h.match(k)&&c.push('<span class="xheGStart"/>')});c.push('<span class="xheGEnd"/><br />');S.after(e('<input type="text" id="'+Ca+'" style="position:absolute;display:none;" /><span id="'+sa+'" class="xhe_'+p.skin+'" style="display:none"><table cellspacing="0" cellpadding="0" class="xheLayout" style="width:'+a+";height:"+T+'px;"><tbody><tr><td id="'+eb+'" class="xheTool" unselectable="on" style="height:1px;"></td></tr><tr><td id="'+fb+'" class="xheIframeArea"><iframe frameborder="0" id="'+
gb+'" src="javascript:;" style="width:100%;"></iframe></td></tr></tbody></table></span>'));K=e("#"+eb);N=e("#"+fb);ta='<meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/><link rel="stylesheet" href="'+Sa+'iframe.css"/>';if(a=p.loadCSS)if(ba(a,"array"))for(var l in a)ta+='<link rel="stylesheet" href="'+a[l]+'"/>';else ta+=a.match(/\s*<style(\s+[^>]*?)?>[\s\S]+?<\/style>\s*/i)?a:'<link rel="stylesheet" href="'+a+'"/>';l="<html><head>"+ta;if(b)l+="<style>body{background:"+b+";}</style>";
l+='</head><body spellcheck="false" class="editMode'+ja+'"></body></html>';d.win=X=e("#"+gb)[0].contentWindow;Z=e(X);try{this.doc=v=X.document;za=e(v);v.open();v.write(l);v.close();if(B)v.body.contentEditable="true";else v.designMode="On"}catch(i){}setTimeout(Ma,300);d.setSource();X.setInterval=null;K.append(c.join("")).bind("mousedown contextmenu",W).click(function(f){var h=e(f.target).closest("a");if(h.is(".xheEnabled")){P=f;d.exec(h.attr("name"))}return false});K.find(".xheButton").hover(function(f){var h=
e(this),o=p.hoverExecDelay,m=ca;ca=null;if(o===-1||ra||!h.is(".xheEnabled"))return false;if(m&&m>10){ra=true;setTimeout(function(){ra=false},100);return false}var q=h.attr("name");if(ma[q].h!==1){d.hidePanel();return false}if(Ra)o=0;if(o>=0)Qa=setTimeout(function(){P=f;ia={x:P.clientX,y:P.clientY};d.exec(q)},o)},function(){ia=null;Qa&&clearTimeout(Qa)}).mousemove(function(f){if(ia){var h={x:f.clientX-ia.x,y:f.clientY-ia.y};if(Math.abs(h.x)>1||Math.abs(h.y)>1){if(h.x>0&&h.y>0){h=Math.round(Math.atan(h.y/
h.x)/0.017453293);ca=ca?(ca+h)/2:h}else ca=null;ia={x:f.clientX,y:f.clientY}}}});L=e("#xhePanel");ka=e("#xheShadow");la=e("#xheCntLine");if(L.length===0){L=e('<div id="xhePanel"></div>').mousedown(function(f){f.stopPropagation()});ka=e('<div id="xheShadow"></div>');la=e('<div id="xheCntLine"></div>');setTimeout(function(){e(document.body).append(L).append(ka).append(la)},10)}e("#"+sa).show();S.hide();N.css("height",T-K.outerHeight());setTimeout(function(){N.css("height",T-K.outerHeight())},100);S.focus(d.focus);
$a.submit(na).bind("reset",Xa);e(window).bind("unload beforeunload",na).bind("resize",Oa);e(document).mousedown(Pa);if(!Wa){e(document).keydown(Va);Wa=true}Z.focus(function(){p.focus&&p.focus()}).blur(function(){p.blur&&p.blur()});U&&Z.click(wb);za.mousedown(Pa).keydown(xb).keypress(vb).dblclick(H).bind("mousedown click",function(f){S.trigger(f.type)});if(B){za.keydown(function(f){var h=d.getRng();if(f.which===8&&h.item){e(h.item(0)).remove();return false}});var j=function(f){f=e(f.target);var h;
if(h=f.css("width"))f.css("width","").attr("width",h.replace(/[^0-9%]+/g,""));if(h=f.css("height"))f.css("height","").attr("height",h.replace(/[^0-9%]+/g,""))};za.bind("controlselect",function(f){f=f.target;e.nodeName(f,"IMG")&&e(f).unbind("resizeend",j).bind("resizeend",j)})}b=e(v.documentElement);b.bind("paste",ub);p.disableContextmenu&&b.bind("contextmenu",W);p.html5Upload&&b.bind("dragenter dragover",function(f){var h;if((h=f.originalEvent.dataTransfer.types)&&e.inArray("Files",h)!==-1)return false}).bind("drop",
function(f){f=f.originalEvent.dataTransfer;var h;if(f&&(h=f.files)&&h.length>0){var o,m;f=["Link","Img","Flash","Media"];var q=[],r;for(o in f){m=f[o];p["up"+m+"Url"]&&p["up"+m+"Url"].match(/^[^!].*/i)&&q.push(m+":,"+p["up"+m+"Ext"])}if(q.length===0)return false;else r=q.join(",");m=function(s){var u,w;for(o=0;o<s.length;o++){u=s[o].fileName.replace(/.+\./,"");if(u=r.match(RegExp("(\\w+):[^:]*,"+u+"(?:,|$)","i")))if(w){if(w!==u[1])return 2}else w=u[1];else return 1}return w}(h);if(m===1)alert("\u4e0a\u4f20\u6587\u4ef6\u7684\u6269\u5c55\u540d\u5fc5\u9700\u4e3a\uff1a"+
r.replace(/\w+:,/g,""));else if(m===2)alert("\u6bcf\u6b21\u53ea\u80fd\u62d6\u653e\u4e0a\u4f20\u540c\u4e00\u7c7b\u578b\u6587\u4ef6");else m&&d.startUpload(h,p["up"+m+"Url"],"*",function(s){var u=[],w;(w=p.onUpload)&&w(s);for(o in s){w=s[o];url=ba(w,"string")?w:w.url;if(url.substr(0,1)==="!")url=url.substr(1);u.push(url)}d.exec(m);e("#xhe"+m+"Url").val(u.join(" "));e("#xheSave").click()});return false}});(b=p.shortcuts)&&e.each(b,function(f,h){d.addShortcuts(f,h)});ea++;Na=true;if(p.fullscreen)d.toggleFullscreen();
else p.sourceMode&&setTimeout(d.toggleSource,20);return true};this.remove=function(){d.hidePanel();na();S.unbind("focus",d.focus);$a.unbind("submit",na).unbind("reset",Xa);e(window).unbind("unload beforeunload",na).unbind("resize",Oa);e(document).unbind("mousedown",Pa);e("#"+sa+",#"+Ca).remove();S.show();Na=false};this.saveBookmark=function(){if(!G){var a=d.getRng();a=a.cloneRange?a.cloneRange():a;ha={top:Z.scrollTop(),rng:a}}};this.loadBookmark=function(){if(!(G||!ha)){d.focus();var a=ha.rng;if(B)a.select();
else{var b=d.getSel();b.removeAllRanges();b.addRange(a)}Z.scrollTop(ha.top);ha=null}};this.focus=function(){G?e("#sourceCode",v).focus():Z.focus();if(B){var a=d.getRng();a.parentElement&&a.parentElement().ownerDocument!==v&&d.setCursorFirst()}return false};this.setCursorFirst=function(a){X.scrollTo(0,0);var b=d.getRng(true),c=v.body,g=c,n;if(a&&g.firstChild&&(n=g.firstChild.tagName)&&n.match(/^p|div|h[1-6]$/i))g=c.firstChild;B?b.moveToElementText(g):b.setStart(g,0);b.collapse(true);if(B)b.select();
else{a=d.getSel();a.removeAllRanges();a.addRange(b)}};this.getSel=function(){return X.getSelection?X.getSelection():v.selection};this.getRng=function(a){var b,c;try{if(!a){b=d.getSel();c=b.rangeCount>0?b.getRangeAt(0):b.createRange?b.createRange():null}c||(c=v.createRange?v.createRange():v.body.createTextRange())}catch(g){}return c};this.getParent=function(a){var b=d.getRng(),c;if(B)c=b.item?b.item(0):b.parentElement();else{c=b.commonAncestorContainer;if(!b.collapsed)if(b.startContainer===b.endContainer&&
b.startOffset-b.endOffset<2&&b.startContainer.hasChildNodes())c=b.startContainer.childNodes[b.startOffset]}a=a?a:"*";c=e(c);c.is(a)||(c=e(c).closest(a));return c};this.getSelect=function(a){var b=d.getSel(),c=d.getRng(),g=true;g=!c||c.item?false:!b||c.boundingWidth===0||c.collapsed;if(a==="text")return g?"":c.text||(b.toString?b.toString():"");if(c.cloneContents){a=e("<div></div>");(c=c.cloneContents())&&a.append(c);c=a.html()}else c=ba(c.item)?c.item(0).outerHTML:ba(c.htmlText)?c.htmlText:c.toString();
if(g)c="";c=d.processHTML(c,"read");c=d.cleanHTML(c);return c=d.formatXHTML(c)};this.pasteHTML=function(a,b){if(G)return false;d.focus();a=d.processHTML(a,"write");var c=d.getSel(),g=d.getRng();if(b!==undefined){if(g.item){var n=g.item(0);g=d.getRng(true);g.moveToElementText(n);g.select()}g.collapse(b)}a+="<"+(B?"img":"span")+' id="_xhe_temp" width="0" height="0" />';if(g.insertNode){g.deleteContents();g.insertNode(g.createContextualFragment(a))}else{if(c.type.toLowerCase()==="control"){c.clear();
g=d.getRng()}g.pasteHTML(a)}n=e("#_xhe_temp",v);var k=n[0];if(B){g.moveToElementText(k);g.select()}else{g.selectNode(k);c.removeAllRanges();c.addRange(g)}n.remove()};this.pasteText=function(a,b){a||(a="");a=d.domEncode(a);a=a.replace(/\r?\n/g,"<br />");d.pasteHTML(a,b)};this.appendHTML=function(a){if(G)return false;d.focus();a=d.processHTML(a,"write");e(v.body).append(a)};this.domEncode=function(a){return a.replace(/[<>]/g,function(b){return{"<":"&lt;",">":"&gt;"}[b]})};this.setSource=function(a){ha=
null;if(typeof a!=="string"&&a!=="")a=C.value;if(G)e("#sourceCode",v).val(a);else{if(p.beforeSetSource)a=p.beforeSetSource(a);a=d.cleanHTML(a);a=d.formatXHTML(a);a=d.processHTML(a,"write");if(B){v.body.innerHTML='<img id="_xhe_temp" width="0" height="0" />'+a+"\n";e("#_xhe_temp",v).remove()}else v.body.innerHTML=a}};this.processHTML=function(a,b){if(b==="write"){a=a.replace(/(<(\/?)(\w+))((?:\s+[\w-]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*((\/?)>)/g,function(k,l,i,j,f,h,o){j=j.toLowerCase();if(va)if(j===
"strong")j="b";else{if(j==="em")j="i"}else if(U)if(j==="strong"){j="span";i||(f+=' class="Apple-style-span" style="font-weight: bold;"')}else if(j==="em"){j="span";i||(f+=' class="Apple-style-span" style="font-style: italic;"')}else if(j==="u"){j="span";i||(f+=' class="Apple-style-span" style="text-decoration: underline;"')}else if(j==="strike"){j="span";i||(f+=' class="Apple-style-span" style="text-decoration: line-through;"')}var m;if(j==="del")j="strike";else if(j==="img")f=f.replace(/\s+emot\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i,
function(r,s){m=s.match(/^(["']?)(.*)\1/)[2];m=m.split(",");if(!m[1]){m[1]=m[0];m[0]=""}if(m[0]==="default")m[0]="";return p.emotMark?r:""});else if(j==="a"&&o)h="></a>";var q;f=f.replace(/\s+([\w-]+)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/g,function(r,s,u){s=s.toLowerCase();u=u.match(/^(["']?)(.*)\1/)[2];if(B&&s.match(/disabled|checked|readonly|selected/)&&u.match(/false|0/i))return"";if(j==="img"&&m&&s==="src")return"";if(s.match(/src|href/))r=(O?" "+s+'="'+aa(u,"abs",O)+'"':r)+" _xhe_"+s+'="'+u+'"';if(U&&
s==="style"){r=r.replace(/(["';])\s*(font-size)\s*:\s*([a-z-]+)\s*([;"'])/i,function(w,x,A,z,J){for(var E,M=0;M<R.length;M++){w=R[M];if(z===w.n){E=w.wkn;break}}return x+A+":"+E+J});if(j==="span"&&u.match(/(^|;)\s*(font-family|font-size|color|background-color)\s*:\s*[^;]+\s*(;|$)/i))q=true}return r});if(m)f+=' src="'+da+(m[0]?m[0]:"default")+"/"+m[1]+'.gif"';if(q)f+=' class="Apple-style-span"';return"<"+i+j+f+h});if(B)a=a.replace(/&apos;/ig,"&#39;");if(!U){var c=function(k,l,i,j){l="";var f,h;if(f=
i.match(/font-family\s*:\s*([^;"]+)/i))l+=' face="'+f[1]+'"';if(f=i.match(/font-size\s*:\s*([^;"]+)/i)){f=f[1].toLowerCase();for(var o=0;o<R.length;o++)if(f===R[o].n||f===R[o].s){h=o+1;break}if(h){l+=' size="'+h+'"';i=i.replace(/(^|;)(\s*font-size\s*:\s*[^;"]+;?)+/ig,"$1")}}if(h=i.match(/(?:^|[\s;])color\s*:\s*([^;"]+)/i)){if(f=h[1].match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i)){h[1]="#";for(o=1;o<=3;o++)h[1]+=(f[o]-0).toString(16)}h[1]=h[1].replace(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,
"#$1$1$2$2$3$3");l+=' color="'+h[1]+'"'}i=i.replace(/(^|;)(\s*(font-family|color)\s*:\s*[^;"]+;?)+/ig,"$1");if(l!==""){if(i)l+=' style="'+i+'"';return"<font"+l+">"+j+"</font>"}else return k};a=a.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)*\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,c);a=a.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)*\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/ig,
c);a=a.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)*\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]*)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,c)}}else{if(U){var g=[{r:/font-weight:\sbold/ig,t:"strong"},{r:/font-style:\sitalic/ig,t:"em"},{r:/text-decoration:\sunderline/ig,t:"u"},{r:/text-decoration:\sline-through/ig,t:"strike"}];c=function(k,l,i,j,f){l=i+j;i="";if(!l)return f;for(j=0;j<g.length;j++)if(l.match(g[j].r)){i=g[j].t;break}return i?"<"+i+">"+f+"</"+i+">":k};for(var n=
0;n<2;n++){a=a.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,c);a=a.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/ig,c);a=a.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,
c)}}a=a.replace(/(<(\w+))((?:\s+[\w-]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*(\/?>)/g,function(k,l,i,j,f){i=i.toLowerCase();var h;j=j.replace(/\s+_xhe_(?:src|href)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i,function(o,m){h=m.match(/^(["']?)(.*)\1/)[2];return""});if(h&&ya)h=aa(h,ya,O);j=j.replace(/\s+([\w-]+)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/g,function(o,m,q){m=m.toLowerCase();if(m==="class"&&q.match(/^["']?(apple|webkit)/i))return"";if(m.match(/^(_xhe_|_moz_|_webkit_)|^jquery\d+/i))return"";if(h&&m.match(/src|href/i))return" "+
m+'="'+h+'"';if(U&&m==="style")o=o.replace(/(["';])\s*(font-size)\s*:\s*([a-z-]+)\s*([;"'])/i,function(r,s,u,w,x){for(var A,z=0;z<R.length;z++){r=R[z];if(w===r.wkn){A=r.n;break}}return s+u+":"+A+x});return o});if(i==="img"&&!j.match(/\s+alt\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/i))j+=' alt=""';return l+j+f})}return a};this.getSource=function(a){var b,c=p.beforeGetSource;if(G){b=e("#sourceCode",v).val();c||(b=b.replace(/(?:(?!<(?:script|style)(?:\s+[^>]*?)?>)[\s\S])+|<(script|style)(?:\s+[^>]*?)?>[\s\S]+<\/\1>/g,
function(g){return g.match(/^<(script|style)(?:\s+[^>]*?)?>/i)?g:g.replace(/(\t*\r?\n\t*)+/g,"")}))}else{b=d.processHTML(v.body.innerHTML,"read");b=b.replace(/^\s*(?:<(p|div)(?:\s+[^>]*?)?>)?\s*(<br(?:\s+[^>]*?)?>)*\s*(?:<\/\1>)?\s*$/i,"");b=d.cleanHTML(b);b=d.formatXHTML(b,a);if(c)b=c(b)}return C.value=b};this.cleanWord=function(a){if(a.match(/mso(-|normal)|WordDocument/i)){var b=p.wordDeepClean;a=a.replace(/<!--[\s\S]*?--\>|<!(--)?\[[\s\S]+?\](--)?>|<style(\s+[^>]*?)?>[\s\S]*?<\/style>/ig,"");a=
a.replace(/<\/?\w+:[^>]*>/ig,"");a=a.replace(/\r?\n/ig,"");a=a.replace(/(<(\w+))((?:\s[\w-]+="[^"]*")*)\s*(\/?>)/ig,function(c,g,n,k,l){if(b&&n.match(/span|a|img/i))return"";n=n.toLowerCase();if(n==="link"&&k.match(/\shref="\s*file:\/\/.+?\s*"/i))return"";k=k.replace(/\sclass="\s*mso[^"]+"/i,"");k=k.replace(/\slang="[^"]*"/i,"");k=k.replace(/\salign="\s*left\s*"/i,"");k=k.replace(/\sstyle="([^"]*)"/i,function(i,j){if(b)return"";return(j=e.trim(j.replace(/\s*(mso-[^:]+:.+?|margin\s*:\s*0cm 0cm 0pt\s*|(text-align|font-variant|line-height)\s*:\s*.+?)(;|$)\s*/ig,
"")))?' style="'+j+'"':""});return g+k+" "+l})}return a};this.cleanHTML=function(a){a=a.replace(/<!?\/?(DOCTYPE|html|body|meta)(\s+[^>]*?)?>/ig,"");var b;a=a.replace(/<head(?:\s+[^>]*?)?>([\s\S]*?)<\/head>/i,function(c,g){b=g.match(/<(script|style)(\s+[^>]*?)?>[\s\S]*?<\/\1>/ig);return""});if(b)a=b.join("")+a;a=a.replace(/<\??xml(:\w+)?(\s+[^>]*?)?>([\s\S]*?<\/xml>)?/ig,"");p.internalScript||(a=a.replace(/<script(\s+[^>]*?)?>[\s\S]*?<\/script>/ig,""));p.internalStyle||(a=a.replace(/<style(\s+[^>]*?)?>[\s\S]*?<\/style>/ig,
""));if(!p.linkTag||!p.inlineScript||!p.inlineStyle)a=a.replace(/(<(\w+))((?:\s+[\w-]+\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))*)\s*(\/?>)/ig,function(c,g,n,k,l){if(!p.linkTag&&n.toLowerCase()==="link")return"";p.inlineScript||(k=k.replace(/\s+on(?:click|dblclick|mouse(down|up|move|over|out|enter|leave|wheel)|key(down|press|up)|change|select|submit|reset|blur|focus|load|unload)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/ig,""));p.inlineStyle||(k=k.replace(/\s+(style|class)\s*=\s*("[^"]*"|'[^']*'|[^>\s]+)/ig,""));
return g+k+" "+l});return a=a.replace(/<\/(strong|b|u|strike|em|i)>((?:\s|<br\/?>|&nbsp;)*?)<\1(\s+[^>]*?)?>/ig,"$2")};this.formatXHTML=function(a,b){function c(t){var y={};t=t.split(",");for(var F=0;F<t.length;F++)y[t[F]]=true;return y}function g(t){if(t){t=t.toLowerCase();var y=s[t];if(y)t=y}else t="";return t}function n(t,y,F){t=g(t);if(h[t])for(;A.last()&&o[A.last()];)k(A.last());m[t]&&A.last()===t&&k(t);(F=f[t]||!!F)||A.push(t);var I=[];I.push("<"+t);y.replace(w,function(hb,ua,ib,jb,kb){ua=ua.toLowerCase();
I.push(" "+ua+'="'+(ib?ib:jb?jb:kb?kb:q[ua]?ua:"")+'"')});I.push((F?" /":"")+">");l(I.join(""),t,true)}function k(t){if(t){t=g(t);for(y=A.length-1;y>=0;y--)if(A[y]===t)break}else var y=0;if(y>=0){for(t=A.length-1;t>=y;t--)l("</"+A[t]+">",A[t]);A.length=y}}function l(t,y,F){if(b===true){t=t.replace(/(\t*\r?\n\t*)+/g,"");if(!t.match(/^\s*$/)){var I=h[y],hb=I?y:"";if(I){F&&E++;M===""&&E--}else M&&E++;if(hb!==M||I)i();J.push(t);y==="br"&&i();if(I&&(f[y]||!F))E--;M=I?y:"";Ua=F}}else J.push(t)}function i(){J.push("\r\n");
if(E>0)for(var t=E;t--;)J.push("\t")}function j(t,y,F,I){if(!F)return I;t="";if(y=F.match(/ face\s*=\s*"\s*([^"]+)\s*"/i))t+="font-family:"+y[1]+";";if(y=F.match(/ size\s*=\s*"\s*(\d+)\s*"/i))t+="font-size:"+R[(y[1]>7?7:y[1]<1?1:y[1])-1].n+";";if(y=F.match(/ color\s*=\s*"\s*([^"]+)\s*"/i))t+="color:"+y[1]+";";if(F=F.match(/ style\s*=\s*"\s*([^"]+)\s*"/i))t+=F[1];if(t)I='<span style="'+t+'">'+I+"</span>";return I}var f=c("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),
h=c("address,applet,blockquote,button,center,dd,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul"),o=c("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),m=c("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),q=c("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),
r=c("script,style"),s={b:"strong",i:"em",s:"del",strike:"del"},u=/^<\??([\w:]+)((?:\s+[\w-:]*(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^>\s]+))?)*)\s*(\/?)>/,w=/\s+([\w-:]+)(?:\s*=\s*(?:"([^"]*)"|'([^']*)'|([^\s]+)))?/g,x=0,A=[],z=a,J=[],E=-1,M="body",Ua;for(A.last=function(){return this[this.length-1]};z.length>0;)if(!A.last()||!r[A.last()]){x=0;if(z.charAt(0)==="<")if(z.charAt(1)==="/"){x=z.indexOf(">",2);if(x!==-1){x++;k(z.substring(2,x-1))}}else if(z.substring(1,4)==="!--"){x=z.indexOf("--\>",4);if(x!==-1){x+=
3;l(z.substring(0,x))}}else if(match=z.match(u)){n(match[1],match[2],match[3]);x=match[0].length}if(x===0){x=z.indexOf("<",1);if(x===-1)x=z.length;l(d.domEncode(z.substring(0,x)))}z=z.substring(x)}else{z=z.replace(/^([\s\S]*?)<\/(style|script)>/i,function(t,y){J.push(y);return""});k(A.last())}k();a=J.join("");J=null;a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,j);
a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/ig,j);a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,j);a=a.replace(/^(\s*\r?\n)+|(\s*\r?\n)+$/g,"");return a=a.replace(/(\t*\r?\n)+/g,"\r\n")};this.toggleShowBlocktag=function(a){if(qa!==a){qa=!qa;a=e(v.body);if(qa){ja+=" showBlocktag";a.addClass("showBlocktag")}else{ja=ja.replace(" showBlocktag","");a.removeClass("showBlocktag")}}};this.toggleSource=
function(a){if(G!==a){K.find("[name=Source]").toggleClass("xheEnabled").toggleClass("xheActive");var b=v.body,c=e(b),g,n;a=0;if(G){g=d.getSource();c.html("").removeAttr("scroll").attr("class","editMode"+ja);if(B)b.contentEditable="true";else v.designMode="On";if(va){d._exec("inserthtml","-");e("#"+Ca).show().focus().hide()}}else{d.pasteHTML('<span id="_xhe_cursor"></span>',true);g=d.getSource(true);a=g.indexOf('<span id="_xhe_cursor"></span>');if(!lb)a=g.substring(0,a).replace(/\r/g,"").length;g=
g.replace(RegExp("(\r\n)?s*"+'<span id="_xhe_cursor"></span>'.replace("/","\\/")+"s*"),"");if(B)b.contentEditable="false";else v.designMode="Off";c.attr("scroll","no").attr("class","sourceMode").html('<textarea id="sourceCode" wrap="soft" spellcheck="false" height="100%" />');n=e("#sourceCode",c).blur(d.getSource)[0]}G=!G;d.setSource(g);if(G){d.focus();if(n.setSelectionRange)n.setSelectionRange(a,a);else{n=n.createTextRange();n.move("character",a);n.select()}}else d.setCursorFirst(true);K.find("[name=Source],[name=Preview]").toggleClass("xheEnabled");
K.find(".xheButton").not("[name=Source],[name=Fullscreen],[name=About]").toggleClass("xheEnabled");setTimeout(Ma,300)}};this.showPreview=function(){var a=p.beforeSetSource,b=d.getSource();if(a)b=a(b);a="<html><head>"+ta+"<title>\u9884\u89c8</title>"+(O?'<base href="'+O+'"/>':"")+"</head><body>"+b+"</body></html>";b=window.screen;b=window.open("","xhePreview","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+Math.round(b.width*0.9)+",height="+Math.round(b.height*
0.8)+",left="+Math.round(b.width*0.05));var c=b.document;c.open();c.write(a);c.close();b.focus()};this.toggleFullscreen=function(a){if(oa!==a){a=e("#"+sa).find(".xheLayout");var b=e("#"+sa);if(oa){a.attr("style",bb);N.height(T-K.outerHeight());setTimeout(function(){e(window).scrollTop(ab)},10)}else{ab=e(window).scrollTop();bb=a.attr("style");a.removeAttr("style");N.height("100%");setTimeout(Oa,100)}if(va){e("#"+Ca).show().focus().hide();setTimeout(d.focus,1)}oa=!oa;b.toggleClass("xhe_Fullscreen");
e("html").toggleClass("xhe_Fullfix");K.find("[name=Fullscreen]").toggleClass("xheActive");setTimeout(Ma,300)}};this.showMenu=function(a,b){var c=e('<div class="xheMenu"></div>'),g=[];e.each(a,function(n,k){g.push('<a href="javascript:void(0);" title="'+(k.t?k.t:k.s)+'" v="'+k.v+'">'+k.s+"</a>")});c.append(g.join(""));c.click(function(n){b(e(n.target).closest("a").attr("v"));d.hidePanel();return false}).mousedown(W);d.showPanel(c)};this.showColor=function(a){var b=e('<div class="xheColor"></div>'),
c=[],g=0;e.each(nb,function(n,k){if(g%7===0)c.push((g>0?"</div>":"")+"<div>");c.push('<a href="javascript:void(0);" xhev="'+k+'" title="'+k+'" style="background:'+k+'"></a>');g++});c.push("</div>");b.append(c.join(""));b.click(function(n){n=n.target;if(e.nodeName(n,"A")){a(e(n).attr("xhev"));d.hidePanel();return false}}).mousedown(W);d.showPanel(b)};this.showPastetext=function(){var a=e('<div>\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl+V)\u628a\u5185\u5bb9\u7c98\u8d34\u5230\u65b9\u6846\u91cc\uff0c\u6309 \u786e\u5b9a</div><div><textarea id="xhePastetextValue" wrap="soft" spellcheck="false" style="width:300px;height:100px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>'),
b=e("#xhePastetextValue",a);e("#xheSave",a).click(function(){d.loadBookmark();var c=b.val();c&&d.pasteText(c);d.hidePanel();return false});d.showDialog(a)};this.showLink=function(){var a=e('<div>\u94fe\u63a5\u5730\u5740: <input type="text" id="xheLinkUrl" value="http://" class="xheText" /></div><div>\u6253\u5f00\u65b9\u5f0f: <select id="xheLinkTarget"><option selected="selected" value="">\u9ed8\u8ba4</option><option value="_blank">\u65b0\u7a97\u53e3</option><option value="_self">\u5f53\u524d\u7a97\u53e3</option><option value="_parent">\u7236\u7a97\u53e3</option></select></div><div style="display:none">\u94fe\u63a5\u6587\u5b57: <input type="text" id="xheLinkText" value="" class="xheText" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>'),
b=d.getParent("a"),c=e("#xheLinkText",a),g=e("#xheLinkUrl",a),n=e("#xheLinkTarget",a),k=e("#xheSave",a),l=d.getSelect();if(b.length===1){g.val($(b,"href"));n.attr("value",b.attr("target"))}else l===""&&c.val(p.defLinkText).closest("div").show();p.upLinkUrl&&d.uploadInit(g,p.upLinkUrl,p.upLinkExt);k.click(function(){var i=g.val();d.loadBookmark();if(i===""||b.length===0)d._exec("unlink");if(i!==""&&i!=="http://"){var j=i.split(" "),f=n.val(),h=c.val();if(j.length>1){d._exec("unlink");l=d.getSelect();
var o='<a href="xhe_tmpurl"',m=[];if(f!=="")o+=' target="'+f+'"';o+=">xhe_tmptext</a>";h=l!==""?l:h?h:i;for(var q in j){i=j[q];if(i!==""){i=i.split("||");f=o;f=f.replace("xhe_tmpurl",i[0]);f=f.replace("xhe_tmptext",i[1]?i[1]:h);m.push(f)}}d.pasteHTML(m.join("&nbsp;"))}else{i=j[0].split("||");h||(h=i[0]);h=i[1]?i[1]:l!==""?"":h?h:i[0];if(b.length===0){h?d.pasteHTML('<a href="#xhe_tmpurl">'+h+"</a>"):d._exec("createlink","#xhe_tmpurl");b=e('a[href$="#xhe_tmpurl"]',v)}else h&&!U&&b.text(h);$(b,"href",
i[0]);f!==""?b.attr("target",f):b.removeAttr("target")}}d.hidePanel();return false});d.showDialog(a)};this.showImg=function(){var a=e('<div>\u56fe\u7247\u6587\u4ef6: <input type="text" id="xheImgUrl" value="http://" class="xheText" /></div><div>\u66ff\u6362\u6587\u672c: <input type="text" id="xheImgAlt" /></div><div>\u5bf9\u9f50\u65b9\u5f0f: <select id="xheImgAlign"><option selected="selected" value="">\u9ed8\u8ba4</option><option value="left">\u5de6\u5bf9\u9f50</option><option value="right">\u53f3\u5bf9\u9f50</option><option value="top">\u9876\u7aef</option><option value="middle">\u5c45\u4e2d</option><option value="baseline">\u57fa\u7ebf</option><option value="bottom">\u5e95\u8fb9</option></select></div><div>\u5bbd\u5ea6\u9ad8\u5ea6: <input type="text" id="xheImgWidth" value=300 style="width:40px;" /> x <input type="text" id="xheImgHeight" style="width:40px;" /></div><div>\u8fb9\u6846\u5927\u5c0f: <input type="text" id="xheImgBorder" style="width:40px;" /></div><div>\u6c34\u5e73\u95f4\u8ddd: <input type="text" id="xheImgHspace" style="width:40px;" /> \u5782\u76f4\u95f4\u8ddd: <input type="text" id="xheImgVspace" style="width:40px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>'),
b=d.getParent("img"),c=e("#xheImgUrl",a),g=e("#xheImgAlt",a),n=e("#xheImgAlign",a),k=e("#xheImgWidth",a),l=e("#xheImgHeight",a),i=e("#xheImgBorder",a),j=e("#xheImgVspace",a),f=e("#xheImgHspace",a),h=e("#xheSave",a);if(b.length===1){c.val($(b,"src"));g.val(b.attr("alt"));n.val(b.attr("align"));k.val(b.attr("width"));l.val(b.attr("height"));i.val(b.attr("border"));var o=b.attr("vspace"),m=b.attr("hspace");j.val(o<=0?"":o);f.val(m<=0?"":m)}p.upImgUrl&&d.uploadInit(c,p.upImgUrl,p.upImgExt);h.click(function(){d.loadBookmark();
var q=c.val();if(q!==""&&q!=="http://"){var r=q.split(" "),s=g.val(),u=n.val(),w=k.val(),x=l.val(),A=i.val(),z=j.val(),J=f.val();if(r.length>1){var E='<img src="xhe_tmpurl"',M=[];if(s!=="")E+=' alt="'+s+'"';if(u!=="")E+=' align="'+u+'"';if(w!=="")E+=' width="'+w+'"';if(x!=="")E+=' height="'+x+'"';if(A!=="")E+=' border="'+A+'"';if(z!=="")E+=' vspace="'+z+'"';if(J!=="")E+=' hspace="'+J+'"';E+=" />";for(var Ua in r){q=r[Ua];if(q!==""){q=q.split("||");s=E;s=s.replace("xhe_tmpurl",q[0]);if(q[1])s='<a href="'+
q[1]+'" target="_blank">'+s+"</a>";M.push(s)}}d.pasteHTML(M.join("&nbsp;"))}else if(r.length===1){q=r[0];if(q!==""){q=q.split("||");if(b.length===0){d.pasteHTML('<img src="'+q[0]+'#xhe_tmpurl" />');b=e('img[src$="#xhe_tmpurl"]',v)}$(b,"src",q[0]);s!==""&&b.attr("alt",s);u!==""?b.attr("align",u):b.removeAttr("align");w!==""?b.attr("width",w):b.removeAttr("width");x!==""?b.attr("height",x):b.removeAttr("height");A!==""?b.attr("border",A):b.removeAttr("border");z!==""?b.attr("vspace",z):b.removeAttr("vspace");
J!==""?b.attr("hspace",J):b.removeAttr("hspace");if(q[1]){r=b.parent("a");if(r.length===0){b.wrap("<a></a>");r=b.parent("a")}$(r,"href",q[1]);r.attr("target","_blank")}}}}else b.length===1&&b.remove();d.hidePanel();return false});d.showDialog(a)};this.showEmbed=function(a,b,c,g,n,k,l){b=e(b);var i=d.getParent('embed[type="'+c+'"],embed[classid="'+g+'"]'),j=e("#xhe"+a+"Url",b),f=e("#xhe"+a+"Width",b),h=e("#xhe"+a+"Height",b);a=e("#xheSave",b);k&&d.uploadInit(j,k,l);d.showDialog(b);if(i.length===1){j.val($(i,
"src"));f.val(i.attr("width"));h.val(i.attr("height"))}a.click(function(){d.loadBookmark();var o=j.val();if(o!==""&&o!=="http://"){var m=f.val(),q=h.val(),r=/^[0-9]+$/;r.test(m)||(m=412);r.test(q)||(q=300);var s='<embed type="'+c+'" classid="'+g+'" src="xhe_tmpurl"'+n;r=o.split(" ");if(r.length>1){s=s+"";var u,w=[];s+=' width="xhe_width" height="xhe_height" />';for(var x in r){o=r[x].split("||");u=s;u=u.replace("xhe_tmpurl",o[0]);u=u.replace("xhe_width",o[1]?o[1]:m);u=u.replace("xhe_height",o[2]?
o[2]:q);o!==""&&w.push(u)}d.pasteHTML(w.join("&nbsp;"))}else if(r.length===1){o=r[0].split("||");if(i.length===0){d.pasteHTML(s.replace("xhe_tmpurl",o[0]+"#xhe_tmpurl")+" />");i=e('embed[src$="#xhe_tmpurl"]',v)}$(i,"src",o[0]);i.attr("width",o[1]?o[1]:m);i.attr("height",o[2]?o[2]:q)}}else i.length===1&&i.remove();d.hidePanel();return false})};this.showEmot=function(a){var b=e('<div class="xheEmot"></div>');a=a?a:Ta?Ta:"default";var c=Da[a],g=da+a+"/",n=0,k=[],l="";l=c.width;var i=c.height,j=c.line,
f=c.count;c=c.list;if(f)for(c=1;c<=f;c++){n++;k.push('<a href="javascript:void(0);" style="background-image:url('+g+c+'.gif);" emot="'+a+","+c+'" xhev="">&nbsp;</a>');n%j===0&&k.push("<br />")}else e.each(c,function(m,q){n++;k.push('<a href="javascript:void(0);" style="background-image:url('+g+m+'.gif);" emot="'+a+","+m+'" title="'+q+'" xhev="'+q+'">&nbsp;</a>');n%j===0&&k.push("<br />")});f=j*(l+12);c=f*0.75;if(Math.ceil(n/j)*(i+12)<=c)c="";l=e("<style>"+(c?".xheEmot div{width:"+(f+20)+"px;height:"+
c+"px;}":"")+".xheEmot div a{width:"+l+"px;height:"+i+"px;}</style><div>"+k.join("")+"</div>").click(function(m){m=m.target;var q=e(m);if(e.nodeName(m,"A")){d.pasteHTML('<img emot="'+q.attr("emot")+'" alt="'+q.attr("xhev")+'">');d.hidePanel();return false}}).mousedown(W);b.append(l);var h=0,o=["<ul>"];e.each(Da,function(m,q){h++;o.push("<li"+(a===m?' class="cur"':"")+'><a href="javascript:void(0);" group="'+m+'">'+q.name+"</a></li>")});if(h>1){o.push('</ul><br style="clear:both;" />');l=e(o.join("")).click(function(m){Ta=
e(m.target).attr("group");d.exec("Emot");return false}).mousedown(W);b.append(l)}d.showPanel(b)};this.showTable=function(){var a=e('<div>\u884c\u6570\u5217\u6570: <input type="text" id="xheTableRows" style="width:40px;" value="3" /> x <input type="text" id="xheTableColumns" style="width:40px;" value="2" /></div><div>\u6807\u9898\u5355\u5143: <select id="xheTableHeaders"><option selected="selected" value="">\u65e0</option><option value="row">\u7b2c\u4e00\u884c</option><option value="col">\u7b2c\u4e00\u5217</option><option value="both">\u7b2c\u4e00\u884c\u548c\u7b2c\u4e00\u5217</option></select></div><div>\u5bbd\u5ea6\u9ad8\u5ea6: <input type="text" id="xheTableWidth" style="width:40px;" value="200" /> x <input type="text" id="xheTableHeight" style="width:40px;" value="" /></div><div>\u8fb9\u6846\u5927\u5c0f: <input type="text" id="xheTableBorder" style="width:40px;" value="1" /></div><div>\u8868\u683c\u95f4\u8ddd: <input type="text" id="xheTableCellSpacing" style="width:40px;" value="1" /> \u8868\u683c\u586b\u5145: <input type="text" id="xheTableCellPadding" style="width:40px;" value="1" /></div><div>\u5bf9\u9f50\u65b9\u5f0f: <select id="xheTableAlign"><option selected="selected" value="">\u9ed8\u8ba4</option><option value="left">\u5de6\u5bf9\u9f50</option><option value="center">\u5c45\u4e2d</option><option value="right">\u53f3\u5bf9\u9f50</option></select></div><div>\u8868\u683c\u6807\u9898: <input type="text" id="xheTableCaption" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>'),
b=e("#xheTableRows",a),c=e("#xheTableColumns",a),g=e("#xheTableHeaders",a),n=e("#xheTableWidth",a),k=e("#xheTableHeight",a),l=e("#xheTableBorder",a),i=e("#xheTableCellSpacing",a),j=e("#xheTableCellPadding",a),f=e("#xheTableAlign",a),h=e("#xheTableCaption",a);e("#xheSave",a).click(function(){d.loadBookmark();var o=h.val(),m=l.val(),q=b.val(),r=c.val(),s=g.val(),u=n.val(),w=k.val(),x=i.val(),A=j.val(),z=f.val();m="<table"+(m!==""?' border="'+m+'"':"")+(u!==""?' width="'+u+'"':"")+(w!==""?' width="'+
w+'"':"")+(x!==""?' cellspacing="'+x+'"':"")+(A!==""?' cellpadding="'+A+'"':"")+(z!==""?' align="'+z+'"':"")+">";if(o!=="")m+="<caption>"+o+"</caption>";if(s==="row"||s==="both"){m+="<tr>";for(o=0;o<r;o++)m+='<th scope="col">&nbsp;</th>';m+="</tr>";q--}m+="<tbody>";for(o=0;o<q;o++){m+="<tr>";for(u=0;u<r;u++)m+=u===0&&(s==="col"||s==="both")?'<th scope="row">&nbsp;</th>':"<td>&nbsp;</td>";m+="</tr>"}m+="</tbody></table>";d.pasteHTML(m);d.hidePanel();return false});d.showDialog(a)};this.showAbout=function(){var a=
e('<div style="font:12px Arial;width:245px;word-wrap:break-word;word-break:break-all;"><p><span style="font-size:20px;color:#1997DF;">xhEditor</span><br />v1.1.2 (build 101201)</p><p>xhEditor\u662f\u57fa\u4e8ejQuery\u5f00\u53d1\u7684\u8de8\u5e73\u53f0\u8f7b\u91cfXHTML\u7f16\u8f91\u5668\uff0c\u57fa\u4e8e<a href="http://www.gnu.org/licenses/lgpl.html" target="_blank">LGPL</a>\u5f00\u6e90\u534f\u8bae\u53d1\u5e03\u3002</p><p>Copyright \u00a9 <a href="http://xheditor.com/" target="_blank">xhEditor.com</a>. All rights reserved.</p></div>');
d.showDialog(a)};this.addShortcuts=function(a,b){a=a.toLowerCase();if(pa[a]===undefined)pa[a]=[];pa[a].push(b)};this.delShortcuts=function(a){delete pa[a]};this.uploadInit=function(a,b,c){function g(f){if(ba(f,"string"))f=[f];var h=false,o,m=f.length,q,r=[];(o=p.onUpload)&&o(f);for(o=0;o<m;o++){q=f[o];q=ba(q,"string")?q:q.url;if(q.substr(0,1)==="!"){h=true;q=q.substr(1)}r.push(q)}a.val(r.join(" "));h&&a.closest(".xheDialog").find("#xheSave").click()}var n=e('<span class="xheUpload"><input type="text" style="visibility:hidden;" tabindex="-1" /><input type="button" value="'+
p.upBtnText+'" class="xheBtn" tabindex="-1" /></span>'),k=e(".xheBtn",n),l=p.html5Upload,i=l?p.upMultiple:1;a.after(n);k.before(a);b=b.replace(/{editorRoot}/ig,V);if(b.substr(0,1)==="!")k.click(function(){Q=false;d.showIframeModal("\u4e0a\u4f20\u6587\u4ef6",b.substr(1),g,null,null,function(){Q=true})});else{n.append('<input type="file"'+(i>1?' multiple=""':"")+' class="xheFile" size="13" name="filedata" tabindex="-1" />');var j=e(".xheFile",n);j.change(function(){d.startUpload(j[0],b,c,g)});setTimeout(function(){a.closest(".xheDialog").bind("dragenter dragover",
W).bind("drop",function(f){f=f.originalEvent.dataTransfer;var h;if(l&&f&&(h=f.files)&&h.length>0)d.startUpload(h,b,c,g);return false})},10)}};this.startUpload=function(a,b,c,g){function n(r,s){var u=Object,w=false;try{u=eval("("+r+")")}catch(x){}if(u.err===undefined||u.msg===undefined)alert(b+" \u4e0a\u4f20\u63a5\u53e3\u53d1\u751f\u9519\u8bef\uff01\r\n\r\n\u8fd4\u56de\u7684\u9519\u8bef\u5185\u5bb9\u4e3a: \r\n\r\n"+r);else if(u.err)alert(u.err);else{k.push(u.msg);w=true}if(!w||s)d.removeModal();s&&
w&&g(k);return w}var k=[],l=p.html5Upload,i=l?p.upMultiple:1,j,f,h=e('<div style="padding:22px 0;text-align:center;line-height:30px;">\u6587\u4ef6\u4e0a\u4f20\u4e2d\uff0c\u8bf7\u7a0d\u5019\u2026\u2026<br /></div>'),o='<img src="'+Sa+'img/loading.gif">';if(!l||a.nodeType&&!((f=a.files)&&f[0])){if(!Ya(a.value,c))return;h.append(o);j=new d.html4Upload(a,b,n)}else{f||(f=a);a=f.length;if(a>i){alert("\u8bf7\u4e0d\u8981\u4e00\u6b21\u4e0a\u4f20\u8d85\u8fc7"+i+"\u4e2a\u6587\u4ef6");return}for(i=0;i<a;i++)if(!Ya(f[i].fileName,
c))return;var m=e('<div class="xheProgress"><div><span>0%</span></div></div>');h.append(m);j=new d.html5Upload("filedata",f,b,n,function(r){if(r.loaded>=0){var s=Math.round(r.loaded*100/r.total)+"%";e("div",m).css("width",s);e("span",m).text(s+" ( "+Za(r.loaded)+" / "+Za(r.total)+" )")}else m.replaceWith(o)})}var q=Q;if(q)Q=false;d.showModal("\u6587\u4ef6\u4e0a\u4f20\u4e2d(Esc\u53d6\u6d88\u4e0a\u4f20)",h,320,150,function(){Q=q;j.remove()});j.start()};this.html4Upload=function(a,b,c){var g="jUploadFrame"+
(new Date).getTime(),n=this,k=e('<iframe name="'+g+'" class="xheHideArea" />').appendTo("body"),l=e('<form action="'+b+'" target="'+g+'" method="post" enctype="multipart/form-data" class="xheHideArea"></form>').appendTo("body"),i=e(a),j=i.clone().attr("disabled","true");i.before(j).appendTo(l);this.remove=function(){if(n!==null){j.before(i).remove();k.remove();l.remove();n=null}};this.onLoad=function(){c(e(k[0].contentWindow.document.body).text(),true)};this.start=function(){l.submit();k.load(n.onLoad)};
return this};this.html5Upload=function(a,b,c,g,n){function k(r,s,u,w){i=new XMLHttpRequest;upload=i.upload;i.onreadystatechange=function(){i.readyState===4&&u(i.responseText)};if(upload)upload.onprogress=function(x){w(x.loaded)};else w(-1);i.open("POST",s);i.setRequestHeader("Content-Type","application/octet-stream");i.setRequestHeader("Content-Disposition",'attachment; name="'+a+'"; filename="'+r.fileName+'"');i.sendAsBinary?i.sendAsBinary(r.getAsBinary()):i.send(r)}function l(r){n&&n({loaded:h+
r,total:o})}for(var i,j=0,f=b.length,h=0,o=0,m=this,q=0;q<f;q++)o+=b[q].fileSize;this.remove=function(){if(i){i.abort();i=null}};this.uploadNext=function(r){if(r){h+=b[j-1].fileSize;l(0)}if((!r||r&&g(r,j===f)===true)&&j<f)k(b[j++],c,m.uploadNext,function(s){l(s)})};this.start=function(){m.uploadNext()}};this.showIframeModal=function(a,b,c,g,n,k){b=e('<iframe frameborder="0" src="'+b.replace(/{editorRoot}/ig,V)+'" style="width:100%;height:100%;display:none;" /><div class="xheModalIfmWait"></div>');
var l=e(b[0]),i=e(b[1]);d.showModal(a,b,g,n,k);l.load(function(){var j=l[0].contentWindow,f=e(j.document);j.callback=function(h){d.removeModal();c(h)};j.unloadme=d.removeModal;f.keydown(d.checkEsc);l.show();i.remove()})};this.showModal=function(a,b,c,g,n){if(xa)return false;ga=p.layerShadow;c=c?c:p.modalWidth;g=g?g:p.modalHeight;Y=e('<div class="xheModal" style="width:'+(c-1)+"px;height:"+g+"px;margin-left:-"+Math.ceil(c/2)+"px;"+(B&&Ea<=7?"":"margin-top:-"+Math.ceil(g/2)+"px")+'">'+(p.modalTitle?
'<div class="xheModalTitle"><span class="xheModalClose" title="\u5173\u95ed (Esc)"></span>'+a+"</div>":"")+'<div class="xheModalContent"></div></div>').appendTo("body");Ga=e('<div class="xheModalOverlay"></div>').appendTo("body");if(ga>0)Fa=e('<div class="xheModalShadow" style="width:'+Y.outerWidth()+"px;height:"+Y.outerHeight()+"px;margin-left:-"+(Math.ceil(c/2)-ga-2)+"px;"+(B&&Ea<=7?"":"margin-top:-"+(Math.ceil(g/2)-ga-2)+"px")+'"></div>').appendTo("body");e(".xheModalContent",Y).css("height",g-
(p.modalTitle?e(".xheModalTitle").outerHeight():0)).html(b);if(B&&Ea===6)Ha=e("select:visible").css("visibility","hidden");e(".xheModalClose",Y).click(d.removeModal);Ga.show();ga>0&&Fa.show();Y.show();xa=true;Ia=n};this.removeModal=function(){Ha&&Ha.css("visibility","visible");Y.html("").remove();ga>0&&Fa.remove();Ga.remove();Ia&&Ia();xa=false};this.showDialog=function(a){var b=e('<div class="xheDialog"></div>');a=e(a);var c=e("#xheSave",a);if(c.length===1){a.find("input[type=text],select").keypress(function(k){if(k.which===
13){c.click();return false}});a.find("textarea").keydown(function(k){if(k.ctrlKey&&k.which===13){c.click();return false}});c.after(' <input type="button" id="xheCancel" value="\u53d6\u6d88" />');e("#xheCancel",a).click(d.hidePanel);if(!p.clickCancelDialog){wa=false;var g=e('<div class="xheFixCancel"></div>').appendTo("body").mousedown(W),n=N.offset();g.css({left:n.left,top:n.top,width:N.outerWidth(),height:N.outerHeight()})}b.mousedown(function(){ra=true})}b.append(a);d.showPanel(b);B||setTimeout(function(){b.find("input[type=text],textarea").filter(":visible").filter(function(){return e(this).css("visibility")!==
"hidden"}).eq(0).focus()},10)};this.showPanel=function(a){if(!P.target)return false;L.html("").append(a).css("left",-999).css("top",-999);fa=e(P.target).closest("a").addClass("xheActive");var b=fa.offset();a=b.left;b=b.top;b+=fa.outerHeight()-1;la.css({left:a+1,top:b,width:fa.width()}).show();if(a+L.outerWidth()>document.body.clientWidth)a-=L.outerWidth()-fa.outerWidth();var c=p.layerShadow;c>0&&ka.css({left:a+c,top:b+c,width:L.outerWidth(),height:L.outerHeight()}).show();L.css({left:a,top:b}).show();
Ra=Q=true};this.hidePanel=function(){if(Q){fa.removeClass("xheActive");ka.hide();la.hide();L.hide();Q=false;if(!wa){e(".xheFixCancel").remove();wa=true}Ra=ra=false;ca=null}};this.exec=function(a){d.focus();d.hidePanel();d.saveBookmark();var b=ma[a];if(!b)return false;if(P===null){P={};var c=K.find(".xheButton[name="+a+"]");if(c.length===1)P.target=c}if(b.e)b.e.call(d);else{a=a.toLowerCase();switch(a){case "cut":try{v.execCommand(a);if(!v.queryCommandSupported(a))throw"Error";}catch(g){alert("\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u4f7f\u7528\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl + X)\u6765\u5b8c\u6210")}break;
case "copy":try{v.execCommand(a);if(!v.queryCommandSupported(a))throw"Error";}catch(n){alert("\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u4f7f\u7528\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl + C)\u6765\u5b8c\u6210")}break;case "paste":try{v.execCommand(a);if(!v.queryCommandSupported(a))throw"Error";}catch(k){alert("\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u4f7f\u7528\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl + V)\u6765\u5b8c\u6210")}break;
case "pastetext":window.clipboardData?d.pasteText(window.clipboardData.getData("Text",true)):d.showPastetext();break;case "blocktag":var l=[];e.each(ob,function(f,h){l.push({s:"<"+h.n+">"+h.t+"</"+h.n+">",v:"<"+h.n+">",t:h.t})});d.showMenu(l,function(f){d._exec("formatblock",f)});break;case "fontface":var i=[];e.each(pb,function(f,h){h.c=h.c?h.c:h.n;i.push({s:'<span style="font-family:'+h.c+'">'+h.n+"</span>",v:h.c,t:h.n})});d.showMenu(i,function(f){d._exec("fontname",f)});break;case "fontsize":var j=
[];e.each(R,function(f,h){j.push({s:'<span style="font-size:'+h.s+';">'+h.t+"("+h.s+")</span>",v:f+1,t:h.t})});d.showMenu(j,function(f){d._exec("fontsize",f)});break;case "fontcolor":d.showColor(function(f){d._exec("forecolor",f)});break;case "backcolor":d.showColor(function(f){if(B)d._exec("backcolor",f);else{La(true);d._exec("hilitecolor",f);La(false)}});break;case "align":d.showMenu(qb,function(f){d._exec(f)});break;case "list":d.showMenu(rb,function(f){d._exec(f)});break;case "link":d.showLink();
break;case "img":d.showImg();break;case "flash":d.showEmbed("Flash",'<div>\u52a8\u753b\u6587\u4ef6: <input type="text" id="xheFlashUrl" value="http://" class="xheText" /></div><div>\u5bbd\u5ea6\u9ad8\u5ea6: <input type="text" id="xheFlashWidth" style="width:40px;" value="480" /> x <input type="text" id="xheFlashHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>',"application/x-shockwave-flash","clsid:d27cdb6e-ae6d-11cf-96b8-4445535400000",
' wmode="opaque" quality="high" menu="false" play="true" loop="true" allowfullscreen="true"',p.upFlashUrl,p.upFlashExt);break;case "media":d.showEmbed("Media",'<div>\u5a92\u4f53\u6587\u4ef6: <input type="text" id="xheMediaUrl" value="http://" class="xheText" /></div><div>\u5bbd\u5ea6\u9ad8\u5ea6: <input type="text" id="xheMediaWidth" style="width:40px;" value="480" /> x <input type="text" id="xheMediaHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>',
"application/x-mplayer2","clsid:6bf52a52-394a-11d3-b153-00c04f79faa6",' enablecontextmenu="false" autostart="false"',p.upMediaUrl,p.upMediaExt);break;case "emot":d.showEmot();break;case "table":d.showTable();break;case "source":d.toggleSource();break;case "preview":d.showPreview();break;case "print":X.print();break;case "fullscreen":d.toggleFullscreen();break;default:d._exec(a);break}}P=null};this._exec=function(a,b,c){c||d.focus();return b!==undefined?v.execCommand(a,
false,b):v.execCommand(a,false,null)}};e(function(){e.fn.oldVal=e.fn.val;e.fn.val=function(C){var D=this,H;if(C===undefined)return D[0]&&(H=D[0].xheditor)?H.getSource():D.oldVal();return D.each(function(){(H=this.xheditor)?H.setSource(C):D.oldVal(C)})};e("textarea").each(function(){var C=e(this),D=C.attr("class").match(/(?:^|\s)xheditor(?:\-(m?full|simple|mini))?(?:\s|$)/i);if(D)C.xheditor(D[1]?{tools:D[1]}:null)})})})(jQuery);
